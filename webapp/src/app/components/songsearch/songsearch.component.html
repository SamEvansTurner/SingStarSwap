<mat-drawer-container class="drawer-container" *ngIf="vm$ | async as vm">
  <mat-drawer #settingsDrawer mode="over" position="start">
    <app-song-filters
      [sortBy]="vm.state.sortBy"
      [showAvailableOnly]="vm.state.showAvailableOnly"
      (sortChange)="onSortChange($event)"
      (filterChange)="onFilterChange($event)">
    </app-song-filters>
    <app-server-settings></app-server-settings>
  </mat-drawer>

  <mat-drawer-content class="main-content">
    <div class="content-container">
      <app-letter-navigation
        class="letter-nav-panel"
        [letters]="vm.state.letterIndex"
        [showSettingsButton]="true"
        (letterClick)="onLetterClick($event)"
        (settingsClick)="onSettingsToggle(settingsDrawer)">
      </app-letter-navigation>

      <div class="songs-container">
        <!-- Loading State -->
        <div *ngIf="vm.showLoading" class="loading-container">
          <div class="loading-content">
            <mat-spinner diameter="48"></mat-spinner>
            <p class="mat-body-1">Loading songs...</p>
          </div>
        </div>

        <!-- Error State -->
        <div *ngIf="vm.showError" class="error-container">
          <mat-card appearance="outlined" class="error-content">
            <mat-card-header>
              <mat-card-title class="mat-headline-6">Oops! Something went wrong</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <p class="mat-body-1">{{ vm.state.error?.errorMessage }}</p>
            </mat-card-content>
            <mat-card-actions align="end">
              <button 
                mat-raised-button 
                color="primary" 
                (click)="processData()">
                Try Again
              </button>
            </mat-card-actions>
          </mat-card>
        </div>

        <!-- Empty State -->
        <div *ngIf="vm.isEmpty" class="empty-container">
          <mat-card appearance="outlined" class="empty-content">
            <mat-card-header>
              <mat-card-title class="mat-headline-6">No songs found</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <p class="mat-body-1">Try adjusting your filters or check your data connection.</p>
            </mat-card-content>
          </mat-card>
        </div>

        <!-- Content -->
        <div *ngIf="vm.showContent" class="songs-content">
          <div class="songs-stats" *ngIf="vm.state.totalSongs > 0">
            <span class="mat-body-2">
              Showing {{ vm.state.songs.length }} of {{ vm.state.totalSongs }} songs
              <span *ngIf="vm.state.showAvailableOnly">
                ({{ vm.state.availableSongs }} available)
              </span>
            </span>
          </div>

          <div class="groups-container">
            <app-song-group
              *ngFor="let group of vm.state.groupedSongs; trackBy: trackByGroup"
              [group]="group"
              [sortBy]="vm.state.sortBy"
              (songSelect)="onSongSelect($event)">
            </app-song-group>
          </div>
        </div>
      </div>
    </div>
  </mat-drawer-content>
</mat-drawer-container>
